# 音频播放设计方案

## 修改记录

|    日期    |   描述   | 版本  |  作者  | 审核 |
| :--------: | :------: | :---: | :----: | :--: |
| 2021-07-21 | 初始版本 | 1.0.0 | 胡光辉 |      |

## 背景

> 嵌入式设备上语音对讲和报警语音播报都会占用喇叭进行播放.

## 编写目的

> 目前需要根据使用场景能灵活配置报警语音播报和对讲的优先级, 报警语音的优先级问题. 

##   结构图

![aout_0](Z:\GIT\hg\aout_queue\docs\project.assets\aout_0.jpg)

## 设计考虑点

### 播报和对讲优先级问题

> 播报和对讲单独发生时, 基本问题不大.主要考虑四种并发情况

![aout_1](Z:\GIT\hg\aout_queue\docs\project.assets\aout_1.jpg)

四种并发情况

1. 开始为对讲

|          情况          |  对讲优先  | 播报优先 |
| :--------------------: | :--------: | :------: |
|   对讲过程中进行播报   | 语音不播报 | 对讲中断 |
| 对讲结束前一点触发播报 | 语音不播报 | 对讲中断 |

2.开始为播报

|           情况           | 对讲优先 |     播报优先      |
| :----------------------: | :------: | :---------------: |
| 播报过程中开启和关闭对讲 | 中断播报 |     对讲无效      |
|    播报结束前开始对讲    | 中断播报 | 播报完毕,对讲有效 |


当设置为播报优先时, 对讲过程中出现报警事件声音联动时, 对讲会被终止.播报结束, 对讲继续.

当设置为对讲优先时, 对讲过程中出现播报事件声音联动时, 声音不进行播报.

### 语音播报优先级问题

> 目前播报的语音种类分为很多种. 升级, 配网, 事件联动.根据事件重要等级需要进行一个排序.针对不同的场景,会有几种处理方法

1. 优先顺序调换
2. 冗余语音剔除(当语音队列中前面有移动侦测,后面出现区域监测的声音联动时, 前面的移动侦测可不用报警)
3. 强制切换情况(关闭声音)

## 设计原则

- 语音报警以文件为单位尽量完整,语音文件尽量为小片段,时间不易过长

  

## 框架结构

## 模块细节

### 语音播报

- [ ] 文件队列-in
- [ ] 文件队列-out
- [ ] 文件队列-process

## 状态判断

当前播放,对讲,播报,空闲

| 方式 |     开始标识     |   结束标识   |
| :--: | :--------------: | :----------: |
| 对讲 | 有实时数据流传输 | 1s无对讲数据 |
| 播报 |     开启播报     | 1s无播报数据 |

